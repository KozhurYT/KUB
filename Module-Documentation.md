

# üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –º–æ–¥—É–ª–µ–π –¥–ª—è kazhurkeUserBot v2.3.0

---

## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–í–≤–µ–¥–µ–Ω–∏–µ](#1-–≤–≤–µ–¥–µ–Ω–∏–µ)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã](#2-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–º–æ–¥—É–ª—å–Ω–æ–π-—Å–∏—Å—Ç–µ–º—ã)
3. [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç: –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –º–æ–¥—É–ª—å](#3-–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç-–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π-–º–æ–¥—É–ª—å)
4. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è](#4-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–º–æ–¥—É–ª—è)
5. [–§—É–Ω–∫—Ü–∏—è `setup(bot)`](#5-—Ñ—É–Ω–∫—Ü–∏—è-setupbot)
6. [–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥](#6-—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è-–∫–æ–º–∞–Ω–¥)
7. [–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π (handlers)](#7-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏-—Å–æ–±—ã—Ç–∏–π-handlers)
8. [–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–¥—É–ª—è (settings_schema)](#8-–Ω–∞—Å—Ç—Ä–æ–π–∫–∏-–º–æ–¥—É–ª—è-settings_schema)
9. [–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–æ–¥—É–ª—è](#9-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏-–º–æ–¥—É–ª—è)
10. [–ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –º–æ–¥—É–ª—è](#10-–∂–∏–∑–Ω–µ–Ω–Ω—ã–π-—Ü–∏–∫–ª-–º–æ–¥—É–ª—è)
11. [–î–æ—Å—Ç—É–ø–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –∏ API](#11-–¥–æ—Å—Ç—É–ø–Ω—ã–µ-–æ–±—ä–µ–∫—Ç—ã-–∏-api)
12. [–£—Ç–∏–ª–∏—Ç—ã —é–∑–µ—Ä–±–æ—Ç–∞](#12-—É—Ç–∏–ª–∏—Ç—ã-—é–∑–µ—Ä–±–æ—Ç–∞)
13. [–†–∞–±–æ—Ç–∞ —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π](#13-—Ä–∞–±–æ—Ç–∞-—Å-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π)
14. [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ —É–¥–∞–ª–µ–Ω–∏–µ –º–æ–¥—É–ª–µ–π](#14-—É—Å—Ç–∞–Ω–æ–≤–∫–∞-–∏-—É–¥–∞–ª–µ–Ω–∏–µ-–º–æ–¥—É–ª–µ–π)
15. [–ö–æ–º–∞–Ω–¥–∞ `.fcfg` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏](#15-–∫–æ–º–∞–Ω–¥–∞-fcfg--—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏)
16. [–ö–æ–º–∞–Ω–¥–∞ `.pip` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–∞–º–∏](#16-–∫–æ–º–∞–Ω–¥–∞-pip--—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-–ø–∞–∫–µ—Ç–∞–º–∏)
17. [–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏](#17-–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ-–º–æ–¥—É–ª–∏)
18. [–ü—Ä–∏–º–µ—Ä—ã –º–æ–¥—É–ª–µ–π](#18-–ø—Ä–∏–º–µ—Ä—ã-–º–æ–¥—É–ª–µ–π)
19. [–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∏ best practices](#19-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏-–∏-best-practices)
20. [–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –ø–æ –æ–±—ä–µ–∫—Ç–∞–º](#20-—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫-–ø–æ-–æ–±—ä–µ–∫—Ç–∞–º)
21. [FAQ](#21-faq)

---

## 1. –í–≤–µ–¥–µ–Ω–∏–µ

**kazhurkeUserBot** (KUB) ‚Äî –æ–¥–Ω–æ—Ñ–∞–π–ª–æ–≤—ã–π Telegram Userbot –Ω–∞ –±–∞–∑–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ **Telethon**, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–π:

- –ú–æ–¥—É–ª—å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Å –≥–æ—Ä—è—á–µ–π –∑–∞–≥—Ä—É–∑–∫–æ–π/–≤—ã–≥—Ä—É–∑–∫–æ–π
- Inline-–ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ –±–æ—Ç–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —É—Å—Ç–∞–Ω–æ–≤–∫—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –º–æ–¥—É–ª–µ–π
- –ì–∏–±–∫—É—é —Å–∏—Å—Ç–µ–º—É –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–æ–¥—É–ª—è
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ pip-–ø–∞–∫–µ—Ç–∞–º–∏ –ø—Ä—è–º–æ –∏–∑ Telegram

–ú–æ–¥—É–ª–∏ ‚Äî —ç—Ç–æ Python-—Ñ–∞–π–ª—ã (`.py`), —Ä–∞–∑–º–µ—â–∞–µ–º—ã–µ –≤ –ø–∞–ø–∫–µ `modules/`. –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ —é–∑–µ—Ä–±–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ –º–æ–¥—É–ª–∏ –∏–∑ —ç—Ç–æ–π –ø–∞–ø–∫–∏, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—è –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.

---

## 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã

```
kazhurkeUserBot
‚îú‚îÄ‚îÄ kub_config.json          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ kub_session.session      # –°–µ—Å—Å–∏—è Telethon (–æ—Å–Ω–æ–≤–Ω–æ–π –∞–∫–∫–∞—É–Ω—Ç)
‚îú‚îÄ‚îÄ kub_inline_session.session # –°–µ—Å—Å–∏—è inline-–±–æ—Ç–∞
‚îú‚îÄ‚îÄ modules/                 # –ü–∞–ø–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –º–æ–¥—É–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ my_module.py
‚îÇ   ‚îú‚îÄ‚îÄ weather.py
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ main.py                  # –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª —é–∑–µ—Ä–±–æ—Ç–∞
```

### –ö–ª—é—á–µ–≤—ã–µ –∫–ª–∞—Å—Å—ã

| –ö–ª–∞—Å—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|
| `Userbot` | –ì–ª–∞–≤–Ω—ã–π –∫–ª–∞—Å—Å —é–∑–µ—Ä–±–æ—Ç–∞. –°–æ–¥–µ—Ä–∂–∏—Ç `client`, `config`, `module_manager`, `inline_panel` |
| `ModuleManager` | –ú–µ–Ω–µ–¥–∂–µ—Ä –º–æ–¥—É–ª–µ–π. –ó–∞–≥—Ä—É–∑–∫–∞, –≤—ã–≥—Ä—É–∑–∫–∞, —É—Å—Ç–∞–Ω–æ–≤–∫–∞, —É–¥–∞–ª–µ–Ω–∏–µ |
| `Module` | –î–∞—Ç–∞–∫–ª–∞—Å—Å –º–æ–¥—É–ª—è. –•—Ä–∞–Ω–∏—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ, –∫–æ–º–∞–Ω–¥—ã, –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ |
| `Command` | –î–∞—Ç–∞–∫–ª–∞—Å—Å –∫–æ–º–∞–Ω–¥—ã. –ò–º—è, –æ–±—Ä–∞–±–æ—Ç—á–∏–∫, –æ–ø–∏—Å–∞–Ω–∏–µ, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ |
| `Config` | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π (JSON-—Ñ–∞–π–ª) |
| `InlinePanel` | Inline-–±–æ—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —é–∑–µ—Ä–±–æ—Ç–æ–º —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫–∏ |

### –ü–æ—Ä—è–¥–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏

1. –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (`kub_config.json`)
2. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Telethon-–∫–ª–∏–µ–Ω—Ç–∞
3. –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö –º–æ–¥—É–ª–µ–π (`core`, `tools`, `fun`, `admin`)
4. –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –º–æ–¥—É–ª–µ–π –∏–∑ `modules/`
5. –ó–∞–ø—É—Å–∫ inline-–±–æ—Ç–∞ (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)

---

## 3. –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç: –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –º–æ–¥—É–ª—å

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `modules/hello.py`:

```python
"""–ú–æ–π –ø–µ—Ä–≤—ã–π –º–æ–¥—É–ª—å –¥–ª—è KUB."""

def setup(bot):
    """–¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –º–æ–¥—É–ª—è."""
    from pathlib import Path
    
    # –°–æ–∑–¥–∞—ë–º –æ–±—ä–µ–∫—Ç –º–æ–¥—É–ª—è
    mod = bot.module_manager.modules.get("hello")
    if not mod:
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–ª–∞—Å—Å—ã, –¥–æ—Å—Ç—É–ø–Ω—ã–µ —á–µ—Ä–µ–∑ bot
        mod = type('Module', (), {
            'name': 'hello',
            'description': '–ú–æ–π –ø–µ—Ä–≤—ã–π –º–æ–¥—É–ª—å',
            'author': 'MyName',
            'version': '1.0',
            'commands': {},
            'handlers': [],
            'on_load': None,
            'on_unload': None,
            'settings': {},
            'settings_schema': [],
            'requirements': [],
        })()

    async def cmd_hello(event):
        """–ö–æ–º–∞–Ω–¥–∞ .hello ‚Äî –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ."""
        await event.edit("üëã –ü—Ä–∏–≤–µ—Ç –æ—Ç –º–æ–µ–≥–æ –º–æ–¥—É–ª—è!")

    # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –∫–æ–º–∞–Ω–¥—É
    from dataclasses import dataclass
    
    cmd = type('Command', (), {
        'name': 'hello',
        'handler': cmd_hello,
        'description': '–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ',
        'module': 'hello',
        'usage': f'{bot.config.prefix}hello',
        'category': 'misc',
    })()

    mod.commands = {'hello': cmd}
    
    bot.module_manager.register_module(mod)
    bot.register_commands(mod)
```

–û–¥–Ω–∞–∫–æ —ç—Ç–æ—Ç —Å–ø–æ—Å–æ–± –≥—Ä–æ–º–æ–∑–¥–∫–∏–π. –ù–∏–∂–µ –ø–æ–∫–∞–∑–∞–Ω **—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å–ø–æ—Å–æ–±** —á–µ—Ä–µ–∑ –∏–º–ø–æ—Ä—Ç –Ω—É–∂–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤.

---

## 4. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —à–∞–±–ª–æ–Ω –º–æ–¥—É–ª—è

```python
# requires: aiohttp, Pillow
# -*- coding: utf-8 -*-
"""
–û–ø–∏—Å–∞–Ω–∏–µ –º–æ–¥—É–ª—è.
–ê–≤—Ç–æ—Ä: YourName
–í–µ—Ä—Å–∏—è: 1.0
"""

__requires__ = ["aiohttp", "Pillow>=9.0"]

# –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –º–æ–¥—É–ª—è —é–∑–µ—Ä–±–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–Ω–µ–¥—Ä—è–µ—Ç –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –∏–º—ë–Ω:
#   bot      ‚Äî —ç–∫–∑–µ–º–ø–ª—è—Ä Userbot
#   client   ‚Äî —ç–∫–∑–µ–º–ø–ª—è—Ä TelegramClient  
#   config   ‚Äî —ç–∫–∑–µ–º–ø–ª—è—Ä Config
#   manager  ‚Äî —ç–∫–∑–µ–º–ø–ª—è—Ä ModuleManager
#   module_config(mod_name, key, default) ‚Äî —á—Ç–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
#   module_config_set(mod_name, key, value) ‚Äî –∑–∞–ø–∏—Å—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏


def setup(bot):
    """
    –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –º–æ–¥—É–ª—è.
    
    Args:
        bot: —ç–∫–∑–µ–º–ø–ª—è—Ä Userbot
    """
    pass
```

### –í–Ω–µ–¥—Ä—è–µ–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –º–æ–¥—É–ª—è –∏–∑ —Ñ–∞–π–ª–∞ (`_load_file`) —é–∑–µ—Ä–±–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –∏–º—ë–Ω –º–æ–¥—É–ª—è —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|-----|----------|
| `bot` | `Userbot` | –ì–ª–∞–≤–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä —é–∑–µ—Ä–±–æ—Ç–∞ |
| `client` | `TelegramClient` | Telethon-–∫–ª–∏–µ–Ω—Ç (–æ—Å–Ω–æ–≤–Ω–æ–π –∞–∫–∫–∞—É–Ω—Ç) |
| `config` | `Config` | –û–±—ä–µ–∫—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ |
| `manager` | `ModuleManager` | –ú–µ–Ω–µ–¥–∂–µ—Ä –º–æ–¥—É–ª–µ–π |
| `module_config` | `Callable` | –§—É–Ω–∫—Ü–∏—è —á—Ç–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫: `module_config(mod_name, key, default)` |
| `module_config_set` | `Callable` | –§—É–Ω–∫—Ü–∏—è –∑–∞–ø–∏—Å–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫: `module_config_set(mod_name, key, value)` |

–≠—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ –º–æ–¥—É–ª—è (–≥–ª–æ–±–∞–ª—å–Ω–æ –≤–Ω—É—Ç—Ä–∏ —Ñ–∞–π–ª–∞), –ø–æ—ç—Ç–æ–º—É –∏—Ö –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏ –≤–Ω–µ `setup()`.

---

## 5. –§—É–Ω–∫—Ü–∏—è `setup(bot)`

–§—É–Ω–∫—Ü–∏—è `setup` ‚Äî —ç—Ç–æ **—Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞** –º–æ–¥—É–ª—è. –ï—Å–ª–∏ –æ–Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –≤ —Ñ–∞–π–ª–µ –º–æ–¥—É–ª—è, —é–∑–µ—Ä–±–æ—Ç –≤—ã–∑–æ–≤–µ—Ç –µ—ë –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–∞, –ø–µ—Ä–µ–¥–∞–≤ —ç–∫–∑–µ–º–ø–ª—è—Ä `Userbot`.

```python
def setup(bot):
    """
    –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –º–æ–¥—É–ª—è.
    
    –ó–¥–µ—Å—å –Ω—É–∂–Ω–æ:
    1. –°–æ–∑–¥–∞—Ç—å –æ–±—ä–µ–∫—Ç Module
    2. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã (async-—Ñ—É–Ω–∫—Ü–∏–∏)
    3. –°–æ–∑–¥–∞—Ç—å –æ–±—ä–µ–∫—Ç—ã Command
    4. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥—É–ª—å —á–µ—Ä–µ–∑ bot.module_manager.register_module()
    5. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã —á–µ—Ä–µ–∑ bot.register_commands()
    6. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
    """
    pass
```

> **–í–∞–∂–Ω–æ:** –§—É–Ω–∫—Ü–∏—è `setup` **–Ω–µ —è–≤–ª—è–µ—Ç—Å—è** async. –ï—Å–ª–∏ –≤–∞–º –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `on_load` (—Å–º. [–ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –º–æ–¥—É–ª—è](#10-–∂–∏–∑–Ω–µ–Ω–Ω—ã–π-—Ü–∏–∫–ª-–º–æ–¥—É–ª—è)).

---

## 6. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥

### –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤ Command –∏ Module

–¢–∞–∫ –∫–∞–∫ `Command` –∏ `Module` –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ñ–∞–π–ª–µ —é–∑–µ—Ä–±–æ—Ç–∞, –º–æ–¥—É–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏—Ö —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º. –ï—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–¥—Ö–æ–¥–æ–≤:

#### –ü–æ–¥—Ö–æ–¥ 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ dataclass –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π)

```python
from dataclasses import dataclass, field
from typing import Dict, List, Callable, Any, Optional


@dataclass
class Command:
    name: str
    handler: Callable
    description: str = ""
    module: str = ""
    usage: str = ""
    category: str = "misc"


@dataclass
class Module:
    name: str
    description: str = ""
    author: str = "Unknown"
    version: str = "1.0"
    commands: Dict[str, 'Command'] = field(default_factory=dict)
    handlers: List[Any] = field(default_factory=list)
    on_load: Optional[Callable] = None
    on_unload: Optional[Callable] = None
    settings: Dict[str, Any] = field(default_factory=dict)
    settings_schema: List[Dict] = field(default_factory=list)
    requirements: List[str] = field(default_factory=list)


def setup(bot):
    mod = Module(
        name="mymod",
        description="–ú–æ–π –º–æ–¥—É–ª—å",
        author="MyName",
        version="1.0",
    )
    
    p = bot.config.prefix

    async def cmd_test(event):
        await event.edit("‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç!")

    mod.commands = {
        "test": Command("test", cmd_test, "–¢–µ—Å—Ç–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞", "mymod", f"{p}test"),
    }

    bot.module_manager.register_module(mod)
    bot.register_commands(mod)
```

#### –ü–æ–¥—Ö–æ–¥ 2: –°–æ–≤–º–µ—Å—Ç–∏–º—ã–π (–±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è dataclass)

–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∏–∑–±–µ–∂–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π `Command` –∏ `Module`, –º–æ–∂–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –º–æ–¥—É–ª—è –ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏, —á—Ç–æ –æ–Ω –¥–æ—Å—Ç—É–ø–µ–Ω. –û–¥–Ω–∞–∫–æ, –ø–æ—Å–∫–æ–ª—å–∫—É —é–∑–µ—Ä–±–æ—Ç –æ–¥–Ω–æ—Ñ–∞–π–ª–æ–≤—ã–π, –ø—Ä–æ—â–µ –≤—Å–µ–≥–æ –ø—Ä–æ–¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è (–æ–Ω–∏ –Ω–µ–±–æ–ª—å—à–∏–µ) –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–¥—Ö–æ–¥ —Å `type()`.

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã Command

```python
@dataclass
class Command:
    name: str          # –ò–º—è –∫–æ–º–∞–Ω–¥—ã (–±–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞). –ü—Ä–∏–º–µ—Ä: "test"
    handler: Callable  # Async-—Ñ—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
    description: str   # –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è .help
    module: str        # –ò–º—è –º–æ–¥—É–ª—è-–≤–ª–∞–¥–µ–ª—å—Ü–∞
    usage: str         # –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è. –ü—Ä–∏–º–µ—Ä: ".test <–∞—Ä–≥—É–º–µ–Ω—Ç>"
    category: str      # –ö–∞—Ç–µ–≥–æ—Ä–∏—è: "misc", "admin", "fun", "tools" –∏ —Ç.–¥.
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã Module

```python
@dataclass
class Module:
    name: str                    # –£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è –º–æ–¥—É–ª—è (—Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –∏–º–µ–Ω–µ–º —Ñ–∞–π–ª–∞ –±–µ–∑ .py)
    description: str             # –û–ø–∏—Å–∞–Ω–∏–µ –º–æ–¥—É–ª—è
    author: str                  # –ê–≤—Ç–æ—Ä
    version: str                 # –í–µ—Ä—Å–∏—è (—Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ)
    commands: Dict[str, Command] # –°–ª–æ–≤–∞—Ä—å –∫–æ–º–∞–Ω–¥: {"cmd_name": Command(...)}
    handlers: List[Any]          # –°–ø–∏—Å–æ–∫ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö event handlers
    on_load: Optional[Callable]  # Callback –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ (–º–æ–∂–µ—Ç –±—ã—Ç—å async)
    on_unload: Optional[Callable]# Callback –ø—Ä–∏ –≤—ã–≥—Ä—É–∑–∫–µ (–º–æ–∂–µ—Ç –±—ã—Ç—å async)
    settings: Dict[str, Any]     # –ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª—è
    settings_schema: List[Dict]  # –°—Ö–µ–º–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ (–¥–ª—è inline-–ø–∞–Ω–µ–ª–∏ –∏ .fcfg)
    requirements: List[str]      # –°–ø–∏—Å–æ–∫ pip-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```

---

## 7. –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π (handlers)

–ü–æ–º–∏–º–æ –∫–æ–º–∞–Ω–¥, –º–æ–¥—É–ª—å –º–æ–∂–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π Telethon.

```python
from telethon import events


def setup(bot):
    mod = Module(name="spy", description="–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ", author="Me", version="1.0")
    
    # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
    async def on_new_message(event):
        # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —á—É–∂–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        if event.out:
            return
        # –õ–æ–≥–∏–∫–∞...
    
    # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º handler —á–µ—Ä–µ–∑ Telethon-–∫–ª–∏–µ–Ω—Ç
    handler = bot.client.on(events.NewMessage(incoming=True))(on_new_message)
    mod.handlers.append(handler)  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –≤—ã–≥—Ä—É–∑–∫–∏
    
    # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
    async def on_deleted(event):
        pass
    
    handler2 = bot.client.on(events.MessageDeleted())(on_deleted)
    mod.handlers.append(handler2)
    
    bot.module_manager.register_module(mod)
    bot.register_commands(mod)
```

> **–í–∞–∂–Ω–æ:** –í—Å–µ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–π—Ç–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤ `mod.handlers`. –≠—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –≤—ã–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª—è ‚Äî —é–∑–µ—Ä–±–æ—Ç –≤—ã–∑–æ–≤–µ—Ç `client.remove_event_handler()` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–∑ –Ω–∏—Ö.

### –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–∏–ø—ã —Å–æ–±—ã—Ç–∏–π Telethon

| –°–æ–±—ã—Ç–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `events.NewMessage` | –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ |
| `events.MessageEdited` | –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è |
| `events.MessageDeleted` | –£–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è |
| `events.MessageRead` | –ü—Ä–æ—á—Ç–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è |
| `events.ChatAction` | –î–µ–π—Å—Ç–≤–∏–µ –≤ —á–∞—Ç–µ (–≤—Ö–æ–¥, –≤—ã—Ö–æ–¥, —Å–º–µ–Ω–∞ —Ñ–æ—Ç–æ...) |
| `events.UserUpdate` | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–Ω–ª–∞–π–Ω/–æ—Ñ—Ñ–ª–∞–π–Ω) |
| `events.CallbackQuery` | –ù–∞–∂–∞—Ç–∏–µ inline-–∫–Ω–æ–ø–∫–∏ |
| `events.InlineQuery` | Inline-–∑–∞–ø—Ä–æ—Å |
| `events.Album` | –ì—Ä—É–ø–ø–∞ –º–µ–¥–∏–∞-—Å–æ–æ–±—â–µ–Ω–∏–π |

---

## 8. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–¥—É–ª—è (settings_schema)

–ú–æ–¥—É–ª–∏ –º–æ–≥—É—Ç –æ–±—ä—è–≤–ª—è—Ç—å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —á–µ—Ä–µ–∑ `settings_schema`. –≠—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã:

- –ß–µ—Ä–µ–∑ inline-–ø–∞–Ω–µ–ª—å (–∫–Ω–æ–ø–∫–∏ –≤ –±–æ—Ç–µ)
- –ß–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É `.fcfg`
- –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ —á–µ—Ä–µ–∑ `module_config()` / `module_config_set()`

### –§–æ—Ä–º–∞—Ç settings_schema

```python
mod.settings_schema = [
    {
        "key": "greeting",        # –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á (—Å—Ç—Ä–æ–∫–∞, –±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤)
        "label": "–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ",    # –û—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è
        "type": "str",            # –¢–∏–ø: "str", "int", "float", "bool", "list"
        "default": "–ü—Ä–∏–≤–µ—Ç!",     # –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        "description": "–¢–µ–∫—Å—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤ —á–∞—Ç",  # –û–ø–∏—Å–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    },
    {
        "key": "enabled",
        "label": "–í–∫–ª—é—á–µ–Ω–æ",
        "type": "bool",
        "default": True,
        "description": "–í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é",
    },
    {
        "key": "max_count",
        "label": "–ú–∞–∫—Å–∏–º—É–º",
        "type": "int",
        "default": 10,
        "description": "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ",
    },
    {
        "key": "threshold",
        "label": "–ü–æ—Ä–æ–≥",
        "type": "float",
        "default": 0.75,
    },
    {
        "key": "ignored_chats",
        "label": "–ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º—ã–µ —á–∞—Ç—ã",
        "type": "list",
        "default": [],
        "description": "ID —á–∞—Ç–æ–≤ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é",
    },
]
```

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–∏–ø—ã

| –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä –∑–Ω–∞—á–µ–Ω–∏—è |
|-----|----------|-----------------|
| `str` | –°—Ç—Ä–æ–∫–∞ | `"–ü—Ä–∏–≤–µ—Ç!"` |
| `int` | –¶–µ–ª–æ–µ —á–∏—Å–ª–æ | `42` |
| `float` | –ß–∏—Å–ª–æ —Å –ø–ª–∞–≤–∞—é—â–µ–π —Ç–æ—á–∫–æ–π | `3.14` |
| `bool` | –õ–æ–≥–∏—á–µ—Å–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ | `true` / `false` |
| `list` | –°–ø–∏—Å–æ–∫ —Å—Ç—Ä–æ–∫ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é) | `"chat1, chat2, chat3"` |

### –ß—Ç–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ –º–æ–¥—É–ª–µ

```python
def setup(bot):
    mod = Module(name="mymod", ...)
    
    mod.settings_schema = [
        {"key": "greeting", "label": "–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ", "type": "str", "default": "–ü—Ä–∏–≤–µ—Ç!"},
        {"key": "enabled", "label": "–í–∫–ª—é—á–µ–Ω–æ", "type": "bool", "default": True},
    ]

    async def cmd_greet(event):
        # –ß—Ç–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        greeting = module_config(bot, "mymod", "greeting", "–ü—Ä–∏–≤–µ—Ç!")
        enabled = module_config(bot, "mymod", "enabled", True)
        
        if not enabled:
            await event.edit("‚ùå –§—É–Ω–∫—Ü–∏—è –æ—Ç–∫–ª—é—á–µ–Ω–∞")
            return
        
        await event.edit(greeting)
    
    # ... —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
```

### –ó–∞–ø–∏—Å—å –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ

```python
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ
module_config_set(bot, "mymod", "greeting", "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!")

# –ò–ª–∏ —á–µ—Ä–µ–∑ bot –Ω–∞–ø—Ä—è–º—É—é
bot.config.data["custom_settings"]["mymod.greeting"] = "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!"
bot.config.save()
```

### –ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è

–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–¥—É–ª–µ–π —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `kub_config.json` –≤ —Å–µ–∫—Ü–∏–∏ `custom_settings`:

```json
{
  "custom_settings": {
    "mymod.greeting": "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!",
    "mymod.enabled": "true",
    "mymod.max_count": "42"
  }
}
```

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ó–Ω–∞—á–µ–Ω–∏—è —Ö—Ä–∞–Ω—è—Ç—Å—è –∫–∞–∫ —Å—Ç—Ä–æ–∫–∏. –§—É–Ω–∫—Ü–∏—è `module_config()` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–≤–æ–¥–∏—Ç –∏—Ö –∫ –Ω—É–∂–Ω–æ–º—É —Ç–∏–ø—É –Ω–∞ –æ—Å–Ω–æ–≤–µ `settings_schema`.

### –ü–æ–≤–µ–¥–µ–Ω–∏–µ –≤ inline-–ø–∞–Ω–µ–ª–∏

- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–∏–ø–∞ `bool` –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–∞–∫ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏ (‚úÖ/‚ùå) —Å –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–º toggle
- –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ç–∏–ø—ã –æ—Ç–∫—Ä—ã–≤–∞—é—Ç –¥–∏–∞–ª–æ–≥ –≤–≤–æ–¥–∞ –Ω–æ–≤–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
- –í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É ¬´‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–¥—É–ª—è¬ª –≤ –ø–∞–Ω–µ–ª–∏ –º–æ–¥—É–ª—è

---

## 9. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–æ–¥—É–ª—è

–Æ–∑–µ—Ä–±–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç pip-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–æ–¥—É–ª–µ–π **–ø–µ—Ä–µ–¥** –∏—Ö –∑–∞–≥—Ä—É–∑–∫–æ–π.

### –°–ø–æ—Å–æ–±—ã –æ–±—ä—è–≤–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

#### –°–ø–æ—Å–æ–± 1: –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã)

```python
# requires: aiohttp, Pillow, pydub
# require: beautifulsoup4
# deps: requests, lxml
# dependencies: opencv-python
```

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ (—Ä–µ–≥–∏—Å—Ç—Ä–æ–Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ):
- `# requires:`
- `# require:`
- `# deps:`
- `# dependencies:`

#### –°–ø–æ—Å–æ–± 2: –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –≤ –∫–æ–¥–µ

```python
__requires__ = ["aiohttp", "Pillow>=9.0", "beautifulsoup4"]
# –∏–ª–∏
__dependencies__ = ["requests"]
# –∏–ª–∏
__deps__ = ["pydub"]
```

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —É–∫–∞–∑–∞–Ω–∏–µ –≤–µ—Ä—Å–∏–π: `Pillow>=9.0`, `aiohttp>=3.8,<4.0`

### –ú–∞–ø–ø–∏–Ω–≥ –∏–º—ë–Ω –ø–∞–∫–µ—Ç–æ–≤

–Æ–∑–µ—Ä–±–æ—Ç –∑–Ω–∞–µ—Ç –æ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è—Ö –º–µ–∂–¥—É pip-–∏–º–µ–Ω–µ–º –∏ import-–∏–º–µ–Ω–µ–º –¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤:

| pip install | import |
|-------------|--------|
| `pillow` | `PIL` |
| `beautifulsoup4` | `bs4` |
| `opencv-python` | `cv2` |
| `pyyaml` | `yaml` |
| `pycryptodome` | `Crypto` |
| `python-dotenv` | `dotenv` |
| `scikit-learn` | `sklearn` |
| `python-magic` | `magic` |
| `speedtest-cli` | `speedtest` |
| `gtts` | `gtts` |
| –∏ –¥—Ä—É–≥–∏–µ... | |

### –ü—Ä–æ—Ü–µ—Å—Å —É—Å—Ç–∞–Ω–æ–≤–∫–∏

1. –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –º–æ–¥—É–ª—è –ø–∞—Ä—Å—è—Ç—Å—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–∑ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞
2. –î–ª—è –∫–∞–∂–¥–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ª–∏ –æ–Ω–∞
3. –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `pip install`
4. –ï—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å ‚Äî –≤—ã–≤–æ–¥–∏—Ç—Å—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –Ω–æ –º–æ–¥—É–ª—å –≤—Å—ë —Ä–∞–≤–Ω–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
5. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `installed_modules` –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –ü—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ —á–µ—Ä–µ–∑ `.im` –∏–ª–∏ `.dlm`

–ü—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –º–æ–¥—É–ª—è —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—ã `.im` (—Ñ–∞–π–ª) –∏–ª–∏ `.dlm` (URL) –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è **–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ** –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å:

```
üì• my_module.py
üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π: aiohttp, Pillow...
‚úÖ my_module | üîß 3 cmd
üì• –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã: aiohttp, Pillow
```

---

## 10. –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –º–æ–¥—É–ª—è

```
–§–∞–π–ª –º–æ–¥—É–ª—è –Ω–∞–π–¥–µ–Ω
        ‚îÇ
        ‚ñº
–ü–∞—Ä—Å–∏–Ω–≥ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏–∑ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞
        ‚îÇ
        ‚ñº
–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (pip install)
        ‚îÇ
        ‚ñº
–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–¥–∞ —Ñ–∞–π–ª–∞ (exec_module)
  - –í–Ω–µ–¥—Ä–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö: bot, client, config, manager, module_config, module_config_set
        ‚îÇ
        ‚ñº
–í—ã–∑–æ–≤ setup(bot) ‚Äî –µ—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞
  - –°–æ–∑–¥–∞–Ω–∏–µ Module, Command
  - register_module()
  - register_commands()
        ‚îÇ
        ‚ñº
–í—ã–∑–æ–≤ on_load() ‚Äî –µ—Å–ª–∏ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω
        ‚îÇ
        ‚ñº
    ‚ïê‚ïê –†–ê–ë–û–¢–ê ‚ïê‚ïê
        ‚îÇ
        ‚ñº
–í—ã–≥—Ä—É–∑–∫–∞ (unload_module)
  - –í—ã–∑–æ–≤ on_unload()
  - –£–¥–∞–ª–µ–Ω–∏–µ event handlers
  - –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ –∏–∑ _command_handlers
  - –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ modules dict
```

### on_load –∏ on_unload

```python
def setup(bot):
    mod = Module(name="mymod", ...)
    
    async def on_load():
        """–í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª—è."""
        print("–ú–æ–¥—É–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω!")
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤, –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∏ —Ç.–¥.
    
    async def on_unload():
        """–í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–µ—Ä–µ–¥ –≤—ã–≥—Ä—É–∑–∫–æ–π –º–æ–¥—É–ª—è."""
        print("–ú–æ–¥—É–ª—å –≤—ã–≥—Ä—É–∂–∞–µ—Ç—Å—è!")
        # –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤, –∑–∞–∫—Ä—ã—Ç–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
    
    mod.on_load = on_load
    mod.on_unload = on_unload
    
    # ... –æ—Å—Ç–∞–ª—å–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
```

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** `on_load` –∏ `on_unload` –º–æ–≥—É—Ç –±—ã—Ç—å –∫–∞–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏, —Ç–∞–∫ –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏. –î–ª—è `on_unload` –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∫–æ—Ä—É—Ç–∏–Ω—ã –æ–±–æ—Ä–∞—á–∏–≤–∞—é—Ç—Å—è –≤ `create_task`.

---

## 11. –î–æ—Å—Ç—É–ø–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –∏ API

### bot (Userbot)

```python
bot.client              # TelegramClient ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∏–µ–Ω—Ç
bot.config              # Config ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
bot.module_manager      # ModuleManager ‚Äî –º–µ–Ω–µ–¥–∂–µ—Ä –º–æ–¥—É–ª–µ–π
bot.inline_panel        # InlinePanel ‚Äî inline-–±–æ—Ç
bot.start_time          # float ‚Äî –≤—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞ (timestamp)
bot._command_handlers   # Dict[str, Command] ‚Äî –≤—Å–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
```

### bot.client (TelegramClient)

–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä `telethon.TelegramClient`. –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:

```python
# –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
await bot.client.send_message(chat_id, "–¢–µ–∫—Å—Ç")
await bot.client.send_file(chat_id, "photo.jpg", caption="–ü–æ–¥–ø–∏—Å—å")

# –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
me = await bot.client.get_me()
entity = await bot.client.get_entity("username")

# –ò—Ç–µ—Ä–∞—Ü–∏—è –ø–æ —Å–æ–æ–±—â–µ–Ω–∏—è–º
async for msg in bot.client.iter_messages(chat_id, limit=100):
    print(msg.text)

# –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –º–µ–¥–∏–∞
path = await bot.client.download_media(message)
data = await bot.client.download_media(message, bytes)  # –í –ø–∞–º—è—Ç—å

# –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤
await bot.client.send_file(chat_id, "/path/to/file")

# –†–∞–±–æ—Ç–∞ —Å —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏
async for user in bot.client.iter_participants(chat_id):
    print(user.first_name)

# –ü–µ—Ä–µ—Å—ã–ª–∫–∞
await bot.client.forward_messages(to_chat, msg_id, from_chat)

# –£–¥–∞–ª–µ–Ω–∏–µ
await bot.client.delete_messages(chat_id, [msg_id])

# Pin/Unpin
await bot.client.pin_message(chat_id, msg_id)
await bot.client.unpin_message(chat_id)
```

### bot.config (Config)

```python
bot.config.prefix            # str ‚Äî —Ç–µ–∫—É—â–∏–π –ø—Ä–µ—Ñ–∏–∫—Å –∫–æ–º–∞–Ω–¥
bot.config.owner_id          # int ‚Äî ID –≤–ª–∞–¥–µ–ª—å—Ü–∞
bot.config.bot_token         # str ‚Äî —Ç–æ–∫–µ–Ω inline-–±–æ—Ç–∞
bot.config.disabled_modules  # list ‚Äî —Å–ø–∏—Å–æ–∫ –æ—Ç–∫–ª—é—á—ë–Ω–Ω—ã—Ö –º–æ–¥—É–ª–µ–π
bot.config.alive_message     # str ‚Äî —à–∞–±–ª–æ–Ω alive-—Å–æ–æ–±—â–µ–Ω–∏—è
bot.config.custom_settings   # dict ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–¥—É–ª–µ–π
bot.config.installed_modules # dict ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –º–æ–¥—É–ª—è—Ö
bot.config.kinfo             # dict ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ kinfo

# –ß—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å
val = bot.config.get("key", "default")
bot.config.set("key", value)  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ —Ñ–∞–π–ª

# –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º
bot.config.data["custom_settings"]["mymod.key"] = "value"
bot.config.save()  # –†—É—á–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
```

### bot.module_manager (ModuleManager)

```python
# –ü–æ–ª—É—á–µ–Ω–∏–µ –º–æ–¥—É–ª–µ–π
bot.module_manager.modules                    # Dict[str, Module] ‚Äî –≤—Å–µ –º–æ–¥—É–ª–∏
bot.module_manager.get_user_modules()         # Dict[str, Module] ‚Äî —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ
bot.module_manager.get_all_commands()         # Dict[str, Command] ‚Äî –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã
bot.module_manager.is_builtin("core")         # bool ‚Äî –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –ª–∏ –º–æ–¥—É–ª—å

# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥—É–ª—è–º–∏
bot.module_manager.register_module(mod)       # –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥—É–ª—å
bot.module_manager.mark_builtin("name")       # –ü–æ–º–µ—Ç–∏—Ç—å –∫–∞–∫ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π
bot.module_manager.unload_module("name")      # –í—ã–≥—Ä—É–∑–∏—Ç—å –º–æ–¥—É–ª—å
bot.module_manager.install_from_file(fn, data) # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ —Ñ–∞–π–ª–∞
await bot.module_manager.install_from_url(url) # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ URL
bot.module_manager.uninstall_module("name")   # –£–¥–∞–ª–∏—Ç—å –º–æ–¥—É–ª—å
bot.module_manager.load_from_directory()       # –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ –º–æ–¥—É–ª–∏ –∏–∑ –ø–∞–ø–∫–∏
```

### bot.inline_panel (InlinePanel)

```python
bot.inline_panel.active      # bool ‚Äî –∞–∫—Ç–∏–≤–Ω–∞ –ª–∏ inline-–ø–∞–Ω–µ–ª—å
bot.inline_panel.inline_bot  # TelegramClient ‚Äî –±–æ—Ç-–∫–ª–∏–µ–Ω—Ç (–∏–ª–∏ None)

await bot.inline_panel.start()    # –ó–∞–ø—É—Å—Ç–∏—Ç—å inline-–±–æ—Ç–∞
await bot.inline_panel.stop()     # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
await bot.inline_panel.restart()  # –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
```

---

## 12. –£—Ç–∏–ª–∏—Ç—ã —é–∑–µ—Ä–±–æ—Ç–∞

–°–ª–µ–¥—É—é—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ñ–∞–π–ª–µ –∏ –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

### format_uptime(seconds) ‚Üí str

```python
format_uptime(3661)  # "1—á 1–º 1—Å"
format_uptime(90061) # "1–¥ 1—á 1–º 1—Å"
```

### truncate(text, mx=4096) ‚Üí str

–û–±—Ä–µ–∑–∞–µ—Ç —Ç–µ–∫—Å—Ç –¥–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –¥–ª–∏–Ω—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 4096 ‚Äî –ª–∏–º–∏—Ç Telegram):

```python
truncate(very_long_text)  # "...—Ç–µ–∫—Å—Ç...\n\n... (–æ–±—Ä–µ–∑–∞–Ω–æ)"
```

### get_user_link(user) ‚Üí str

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç Markdown-—Å—Å—ã–ª–∫—É –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

```python
link = await get_user_link(user)  # "[–ò–º—è](tg://user?id=123)"
```

### get_raw_github_url(url) ‚Üí str

–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç GitHub-—Å—Å—ã–ª–∫—É –≤ raw-—Å—Å—ã–ª–∫—É –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è:

```python
get_raw_github_url("https://github.com/user/repo/blob/main/module.py")
# ‚Üí "https://raw.githubusercontent.com/user/repo/main/module.py"
```

### module_config(bot, mod_name, key, default=None)

–ß—Ç–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–¥—É–ª—è —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ–º —Ç–∏–ø–∞:

```python
value = module_config(bot, "mymod", "greeting", "–ü—Ä–∏–≤–µ—Ç!")
enabled = module_config(bot, "mymod", "enabled", True)  # ‚Üí bool
count = module_config(bot, "mymod", "max_count", 10)     # ‚Üí int
```

### module_config_set(bot, mod_name, key, value)

–ó–∞–ø–∏—Å—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–¥—É–ª—è:

```python
module_config_set(bot, "mymod", "greeting", "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!")
```

### –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏

```python
parse_module_requirements(content: str) ‚Üí List[str]  # –ü–∞—Ä—Å–∏–Ω–≥ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏–∑ –∫–æ–¥–∞
is_package_installed(package: str) ‚Üí bool             # –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–∞–∫–µ—Ç–∞
install_pip_package(package: str) ‚Üí Tuple[bool, str]  # –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞
uninstall_pip_package(package: str) ‚Üí Tuple[bool, str]# –£–¥–∞–ª–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–∞
check_and_install_requirements(content: str) ‚Üí Dict   # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

# –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –≤–µ—Ä—Å–∏–∏
await async_install_pip_package(package: str) ‚Üí Tuple[bool, str]
await async_check_and_install_requirements(content: str) ‚Üí Dict
```

---

## 13. –†–∞–±–æ—Ç–∞ —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ kub_config.json

```json
{
  "api_id": 12345,
  "api_hash": "abc...",
  "phone": "+7...",
  "bot_token": "123:ABC...",
  "prefix": ".",
  "alive_message": "{emoji} **{brand}** —Ä–∞–±–æ—Ç–∞–µ—Ç!\n...",
  "disabled_modules": ["somemod"],
  "custom_settings": {
    "mymod.greeting": "–ü—Ä–∏–≤–µ—Ç!",
    "mymod.enabled": "true"
  },
  "owner_id": 123456789,
  "installed_modules": {
    "mymod": {
      "filename": "mymod.py",
      "installed_at": "2024-01-01T00:00:00",
      "source": "file",
      "requirements": ["aiohttp"],
      "url": "https://..."
    }
  },
  "kinfo": {
    "template": "...",
    "emoji": "ü¶ä",
    "photo": "",
    "show_ping": true,
    "show_uptime": true,
    "custom_lines": []
  },
  "stats": {
    "commands_used": 42,
    "started_at": 1700000000
  }
}
```

### –†–∞–±–æ—Ç–∞ —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –≤ –º–æ–¥—É–ª–µ

```python
def setup(bot):
    # –ß—Ç–µ–Ω–∏–µ
    prefix = bot.config.prefix
    owner = bot.config.owner_id
    
    # –ó–∞–ø–∏—Å—å —Å –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
    bot.config.set("my_custom_key", "value")
    
    # –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø
    bot.config.data["my_key"] = "value"
    bot.config.save()
    
    # –ü–æ–ª—É—á–µ–Ω–∏–µ —Å –∑–Ω–∞—á–µ–Ω–∏–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    val = bot.config.get("nonexistent", "default")
```

---

## 14. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ —É–¥–∞–ª–µ–Ω–∏–µ –º–æ–¥—É–ª–µ–π

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏–∑ —Ñ–∞–π–ª–∞ (`.im`)

1. –û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å `.py` —Ñ–∞–π–ª–æ–º
2. –ù–∞–ø–∏—à–∏—Ç–µ `.im`

–Æ–∑–µ—Ä–±–æ—Ç:
1. –°–∫–∞—á–∞–µ—Ç —Ñ–∞–π–ª
2. –°–ø–∞—Ä—Å–∏—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –ø–∞–∫–µ—Ç—ã
4. –ó–∞–≥—Ä—É–∑–∏—Ç –º–æ–¥—É–ª—å
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ `installed_modules`

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏–∑ URL (`.dlm`)

```
.dlm https://github.com/user/repo/blob/main/modules/mymod.py
.dlm https://gist.github.com/user/abc123
.dlm https://example.com/module.py
```

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è:
- –ü—Ä—è–º—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ `.py` —Ñ–∞–π–ª—ã
- GitHub blob-—Å—Å—ã–ª–∫–∏ (–∞–≤—Ç–æ–∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ raw)
- GitHub Gist (–∞–≤—Ç–æ–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ `/raw`)

### –£–¥–∞–ª–µ–Ω–∏–µ –º–æ–¥—É–ª—è (`.um`)

```
.um mymod
```

–£–¥–∞–ª—è–µ—Ç —Ñ–∞–π–ª –∏–∑ `modules/`, –≤—ã–≥—Ä—É–∂–∞–µ—Ç –º–æ–¥—É–ª—å, –æ—á–∏—â–∞–µ—Ç `installed_modules`.

### –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª–µ–π (`.reload`)

–í—ã–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –º–æ–¥—É–ª–∏ –∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∑–∞–Ω–æ–≤–æ –∏–∑ `modules/`.

### –ü—Ä–æ—Å–º–æ—Ç—Ä –º–æ–¥—É–ª–µ–π

```
.modules    ‚Äî –≤—Å–µ –º–æ–¥—É–ª–∏ (–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ + –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ)
.lm         ‚Äî —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –º–æ–¥—É–ª–∏ —Å –¥–µ—Ç–∞–ª—è–º–∏
```

---

## 15. –ö–æ–º–∞–Ω–¥–∞ `.fcfg` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏

–ö–æ–º–∞–Ω–¥–∞ `.fcfg` –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –º–æ–¥—É–ª–µ–π –∏–∑ —á–∞—Ç–∞.

### –°–∏–Ω—Ç–∞–∫—Å–∏—Å

```
.fcfg set -m <–º–æ–¥—É–ª—å> <–ø–∞—Ä–∞–º–µ—Ç—Ä> <–∑–Ω–∞—á–µ–Ω–∏–µ>
.fcfg remove -m <–º–æ–¥—É–ª—å> <–ø–∞—Ä–∞–º–µ—Ç—Ä>
.fcfg reset -m <–º–æ–¥—É–ª—å>
```

### –ü—Ä–∏–º–µ—Ä—ã

```
.fcfg set -m mymod greeting –ü—Ä–∏–≤–µ—Ç, –º–∏—Ä!
.fcfg set -m mymod enabled true
.fcfg set -m mymod max_count 42
.fcfg remove -m mymod greeting
.fcfg reset -m mymod
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –Ω–∞—Å—Ç—Ä–æ–µ–∫ –º–æ–¥—É–ª—è

```
.fcfg set -m mymod
```

–ë–µ–∑ —É–∫–∞–∑–∞–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –∏ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–∫–∞–∂–µ—Ç –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–¥—É–ª—è (–∏–∑ `settings_schema`).

### –í–∞–ª–∏–¥–∞—Ü–∏—è

–ü—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ `settings_schema` –∑–Ω–∞—á–µ–Ω–∏—è –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è –ø–æ —Ç–∏–ø—É:
- `int` ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ —è–≤–ª—è–µ—Ç—Å—è —á–∏—Å–ª–æ–º
- `float` ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ —è–≤–ª—è–µ—Ç—Å—è —á–∏—Å–ª–æ–º —Å –ø–ª–∞–≤–∞—é—â–µ–π —Ç–æ—á–∫–æ–π
- `bool` ‚Äî –¥–æ–ø—É—Å–∫–∞—é—Ç—Å—è: `true/false`, `1/0`, `yes/no`, `–¥–∞/–Ω–µ—Ç`, `on/off`

---

## 16. –ö–æ–º–∞–Ω–¥–∞ `.pip` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–∞–º–∏

### –ü–æ–¥–∫–æ–º–∞–Ω–¥—ã

```
.pip install <–ø–∞–∫–µ—Ç>      ‚Äî —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å pip-–ø–∞–∫–µ—Ç
.pip uninstall <–ø–∞–∫–µ—Ç>    ‚Äî —É–¥–∞–ª–∏—Ç—å pip-–ø–∞–∫–µ—Ç
.pip check <–ø–∞–∫–µ—Ç>        ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ª–∏ –ø–∞–∫–µ—Ç
.pip search <–ø–∞–∫–µ—Ç>       ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–∞–∫–µ—Ç–µ (–≤–µ—Ä—Å–∏—è, –æ–ø–∏—Å–∞–Ω–∏–µ, –∞–≤—Ç–æ—Ä)
.pip list                 ‚Äî —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
.pip deps <–º–æ–¥—É–ª—å>        ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–æ–¥—É–ª—è
```

### –ü—Ä–∏–º–µ—Ä—ã

```
.pip install aiohttp
.pip check Pillow
.pip deps mymod
.pip list
```

---

## 17. –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏

### core (–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã)

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `.alive` | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ |
| `.kinfo` | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ |
| `.kset <sub>` | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ kinfo (emoji, photo, addline, clearlines, reset) |
| `.help [cmd]` | –°–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥ / –ø–æ–º–æ—â—å –ø–æ –∫–æ–º–∞–Ω–¥–µ |
| `.ping` | –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–¥–µ—Ä–∂–∫–∏ |
| `.prefix <new>` | –ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–µ—Ñ–∏–∫—Å |
| `.modules` | –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π |
| `.reload` | –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª–µ–π |
| `.eval <expr>` | –í—ã–ø–æ–ª–Ω–∏—Ç—å Python-–≤—ã—Ä–∞–∂–µ–Ω–∏–µ |
| `.exec <code>` | –í—ã–ø–æ–ª–Ω–∏—Ç—å Python-–∫–æ–¥ |
| `.settings` | –û—Ç–∫—Ä—ã—Ç—å inline-–ø–∞–Ω–µ–ª—å |
| `.settoken <token>` | –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω inline-–±–æ—Ç–∞ |
| `.status` | –°—Ç–∞—Ç—É—Å —é–∑–µ—Ä–±–æ—Ç–∞ |
| `.im` | –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–æ–¥—É–ª—å –∏–∑ —Ñ–∞–π–ª–∞ (–æ—Ç–≤–µ—Ç–æ–º) |
| `.um <name>` | –£–¥–∞–ª–∏—Ç—å –º–æ–¥—É–ª—å |
| `.dlm <url>` | –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–æ–¥—É–ª—å –ø–æ URL |
| `.lm` | –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –º–æ–¥—É–ª–µ–π |
| `.pip <sub>` | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–∞–º–∏ |
| `.fcfg <sub>` | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–¥—É–ª–µ–π |

### tools (–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã)

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `.id` | –ü–æ–∫–∞–∑–∞—Ç—å ID —á–∞—Ç–∞/–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è/—Å–æ–æ–±—â–µ–Ω–∏—è |
| `.info [user]` | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ |
| `.del` | –£–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ |
| `.purge` | –£–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –æ—Ç–≤–µ—Ç–∞ –¥–æ —Ç–µ–∫—É—â–µ–≥–æ |
| `.chatinfo` | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —á–∞—Ç–µ |
| `.calc <expr>` | –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä |
| `.sd <—Å–µ–∫> <—Ç–µ–∫—Å—Ç>` | –°–∞–º–æ—É–Ω–∏—á—Ç–æ–∂–∞—é—â–µ–µ—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ |
| `.search <query>` | –ü–æ–∏—Å–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —á–∞—Ç–µ |

### fun (–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è)

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `.reverse <text>` | –ü–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç—å —Ç–µ–∫—Å—Ç |
| `.upper <text>` | –ü—Ä–∏–≤–µ—Å—Ç–∏ –∫ –í–ï–†–•–ù–ï–ú–£ —Ä–µ–≥–∏—Å—Ç—Ä—É |
| `.lower <text>` | –ü—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É |
| `.mock <text>` | —Ä–ê–Ω–î–æ–ú–Ω–´–π –†–µ–ì–∏–°—Ç–† |
| `.repeat <n> <text>` | –ü–æ–≤—Ç–æ—Ä–∏—Ç—å —Ç–µ–∫—Å—Ç N —Ä–∞–∑ |
| `.type <text>` | –≠—Ñ—Ñ–µ–∫—Ç –ø–µ—á–∞—Ç–∞–Ω–∏—è |
| `.dice [sides]` | –ë—Ä–æ—Å–∏—Ç—å –∫—É–±–∏–∫ |
| `.coin` | –ü–æ–¥–±—Ä–æ—Å–∏—Ç—å –º–æ–Ω–µ—Ç–∫—É |
| `.choose a \| b \| c` | –°–ª—É—á–∞–π–Ω—ã–π –≤—ã–±–æ—Ä |
| `.rate <thing>` | –†–∞–Ω–¥–æ–º–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ |

### admin (–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ)

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `.ban` | –ó–∞–±–∞–Ω–∏—Ç—å (–æ—Ç–≤–µ—Ç–æ–º) |
| `.unban` | –†–∞–∑–±–∞–Ω–∏—Ç—å (–æ—Ç–≤–µ—Ç–æ–º) |
| `.kick` | –ö–∏–∫–Ω—É—Ç—å (–æ—Ç–≤–µ—Ç–æ–º) |
| `.mute [time]` | –ó–∞–º—É—Ç–∏—Ç—å (5m, 2h, 1d) |
| `.unmute` | –†–∞–∑–º—É—Ç–∏—Ç—å |
| `.pin` | –ó–∞–∫—Ä–µ–ø–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ |
| `.unpin` | –û—Ç–∫—Ä–µ–ø–∏—Ç—å |

---

## 18. –ü—Ä–∏–º–µ—Ä—ã –º–æ–¥—É–ª–µ–π

### –ü—Ä–∏–º–µ—Ä 1: –ü—Ä–æ—Å—Ç–æ–π –º–æ–¥—É–ª—å —Å –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π

**`modules/hello.py`**

```python
"""
–ü—Ä–æ—Å—Ç–æ–π –º–æ–¥—É–ª—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è.
"""

from dataclasses import dataclass, field
from typing import Dict, List, Callable, Any, Optional


@dataclass
class Command:
    name: str
    handler: Callable
    description: str = ""
    module: str = ""
    usage: str = ""
    category: str = "misc"


@dataclass
class Module:
    name: str
    description: str = ""
    author: str = "Unknown"
    version: str = "1.0"
    commands: Dict[str, Command] = field(default_factory=dict)
    handlers: List[Any] = field(default_factory=list)
    on_load: Optional[Callable] = None
    on_unload: Optional[Callable] = None
    settings: Dict[str, Any] = field(default_factory=dict)
    settings_schema: List[Dict] = field(default_factory=list)
    requirements: List[str] = field(default_factory=list)


def setup(bot):
    mod = Module(
        name="hello",
        description="–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –º–æ–¥—É–ª—å",
        author="Developer",
        version="1.0",
    )
    p = bot.config.prefix

    async def cmd_hello(event):
        """–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ."""
        args = event.raw_text.split(maxsplit=1)
        name = args[1] if len(args) > 1 else "–º–∏—Ä"
        await event.edit(f"üëã –ü—Ä–∏–≤–µ—Ç, **{name}**!")

    mod.commands = {
        "hello": Command("hello", cmd_hello, "–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ", "hello", f"{p}hello [–∏–º—è]"),
    }

    bot.module_manager.register_module(mod)
    bot.register_commands(mod)
```

### –ü—Ä–∏–º–µ—Ä 2: –ú–æ–¥—É–ª—å —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏

**`modules/greeter.py`**

```python
"""
–ú–æ–¥—É–ª—å –∞–≤—Ç–æ–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏.
"""
# requires: 

from dataclasses import dataclass, field
from typing import Dict, List, Callable, Any, Optional
from telethon import events


@dataclass
class Command:
    name: str
    handler: Callable
    description: str = ""
    module: str = ""
    usage: str = ""
    category: str = "misc"


@dataclass
class Module:
    name: str
    description: str = ""
    author: str = "Unknown"
    version: str = "1.0"
    commands: Dict[str, Command] = field(default_factory=dict)
    handlers: List[Any] = field(default_factory=list)
    on_load: Optional[Callable] = None
    on_unload: Optional[Callable] = None
    settings: Dict[str, Any] = field(default_factory=dict)
    settings_schema: List[Dict] = field(default_factory=list)
    requirements: List[str] = field(default_factory=list)


def setup(bot):
    mod = Module(
        name="greeter",
        description="–ê–≤—Ç–æ–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –Ω–æ–≤—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤",
        author="Developer",
        version="1.2",
    )
    p = bot.config.prefix

    # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–¥—É–ª—è
    mod.settings_schema = [
        {
            "key": "enabled",
            "label": "–í–∫–ª—é—á–µ–Ω–æ",
            "type": "bool",
            "default": True,
            "description": "–í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ",
        },
        {
            "key": "message",
            "label": "–°–æ–æ–±—â–µ–Ω–∏–µ",
            "type": "str",
            "default": "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {name}! üëã",
            "description": "–®–∞–±–ª–æ–Ω –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è. {name} = –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",
        },
        {
            "key": "delete_after",
            "label": "–£–¥–∞–ª–∏—Ç—å —á–µ—Ä–µ–∑ (—Å–µ–∫)",
            "type": "int",
            "default": 0,
            "description": "–£–¥–∞–ª–∏—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ —á–µ—Ä–µ–∑ N —Å–µ–∫—É–Ω–¥ (0 = –Ω–µ —É–¥–∞–ª—è—Ç—å)",
        },
    ]

    import asyncio

    # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è –≤ —á–∞—Ç
    async def on_chat_action(event):
        if not event.user_joined and not event.user_added:
            return

        enabled = module_config(bot, "greeter", "enabled", True)
        if not enabled:
            return

        user = await event.get_user()
        if not user:
            return

        template = module_config(bot, "greeter", "message", "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {name}! üëã")
        name = user.first_name or "–¥—Ä—É–≥"

        try:
            text = template.format(name=name)
        except (KeyError, IndexError):
            text = f"–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {name}! üëã"

        msg = await event.reply(text)

        delete_after = module_config(bot, "greeter", "delete_after", 0)
        if delete_after and delete_after > 0:
            await asyncio.sleep(delete_after)
            try:
                await msg.delete()
            except Exception:
                pass

    handler = bot.client.on(events.ChatAction())(on_chat_action)
    mod.handlers.append(handler)

    # –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏/—É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    async def cmd_greeter(event):
        enabled = module_config(bot, "greeter", "enabled", True)
        message = module_config(bot, "greeter", "message", "...")
        delete_after = module_config(bot, "greeter", "delete_after", 0)

        await event.edit(
            f"üëã **Greeter**\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n"
            f"{'‚úÖ' if enabled else '‚ùå'} –°—Ç–∞—Ç—É—Å: {'–í–∫–ª' if enabled else '–í—ã–∫–ª'}\n"
            f"üí¨ –®–∞–±–ª–æ–Ω: `{message}`\n"
            f"‚è± –£–¥–∞–ª–∏—Ç—å —á–µ—Ä–µ–∑: {delete_after}—Å\n\n"
            f"–ù–∞—Å—Ç—Ä–æ–π–∫–∏: `{p}fcfg set -m greeter <param> <value>`"
        )

    mod.commands = {
        "greeter": Command("greeter", cmd_greeter, "–°—Ç–∞—Ç—É—Å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è", "greeter", f"{p}greeter"),
    }

    bot.module_manager.register_module(mod)
    bot.register_commands(mod)
```

### –ü—Ä–∏–º–µ—Ä 3: –ú–æ–¥—É–ª—å —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏

**`modules/weather.py`**

```python
"""
–ú–æ–¥—É–ª—å –ø–æ–≥–æ–¥—ã.
"""
# requires: aiohttp

__requires__ = ["aiohttp"]

from dataclasses import dataclass, field
from typing import Dict, List, Callable, Any, Optional


@dataclass
class Command:
    name: str
    handler: Callable
    description: str = ""
    module: str = ""
    usage: str = ""
    category: str = "misc"


@dataclass
class Module:
    name: str
    description: str = ""
    author: str = "Unknown"
    version: str = "1.0"
    commands: Dict[str, Command] = field(default_factory=dict)
    handlers: List[Any] = field(default_factory=list)
    on_load: Optional[Callable] = None
    on_unload: Optional[Callable] = None
    settings: Dict[str, Any] = field(default_factory=dict)
    settings_schema: List[Dict] = field(default_factory=list)
    requirements: List[str] = field(default_factory=list)


def setup(bot):
    mod = Module(
        name="weather",
        description="–ü–æ–≥–æ–¥–∞ —á–µ—Ä–µ–∑ wttr.in",
        author="Developer",
        version="1.0",
    )
    p = bot.config.prefix

    mod.settings_schema = [
        {
            "key": "default_city",
            "label": "–ì–æ—Ä–æ–¥ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é",
            "type": "str",
            "default": "Moscow",
            "description": "–ì–æ—Ä–æ–¥ –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ –ø–æ–≥–æ–¥—ã, –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω",
        },
        {
            "key": "lang",
            "label": "–Ø–∑—ã–∫",
            "type": "str",
            "default": "ru",
            "description": "–Ø–∑—ã–∫ –æ—Ç–≤–µ—Ç–∞ (ru, en, de, ...)",
        },
    ]

    import aiohttp

    async def cmd_weather(event):
        args = event.raw_text.split(maxsplit=1)
        city = args[1] if len(args) > 1 else module_config(bot, "weather", "default_city", "Moscow")
        lang = module_config(bot, "weather", "lang", "ru")

        await event.edit(f"üå§ –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–≥–æ–¥—ã –¥–ª—è **{city}**...")

        try:
            async with aiohttp.ClientSession() as session:
                url = f"https://wttr.in/{city}?format=3&lang={lang}"
                async with session.get(url, timeout=aiohttp.ClientTimeout(total=10)) as resp:
                    if resp.status == 200:
                        text = await resp.text()
                        await event.edit(f"üå§ {text.strip()}")
                    else:
                        await event.edit(f"‚ùå –û—à–∏–±–∫–∞ HTTP {resp.status}")
        except Exception as e:
            await event.edit(f"‚ùå {e}")

    mod.commands = {
        "weather": Command("weather", cmd_weather, "–ü–æ–≥–æ–¥–∞", "weather", f"{p}weather [–≥–æ—Ä–æ–¥]"),
    }

    bot.module_manager.register_module(mod)
    bot.register_commands(mod)
```

### –ü—Ä–∏–º–µ—Ä 4: –ú–æ–¥—É–ª—å —Å on_load/on_unload –∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º

**`modules/notes.py`**

```python
"""
–ú–æ–¥—É–ª—å –∑–∞–º–µ—Ç–æ–∫ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ —Ñ–∞–π–ª.
"""

import json
import os
from dataclasses import dataclass, field
from typing import Dict, List, Callable, Any, Optional


@dataclass
class Command:
    name: str
    handler: Callable
    description: str = ""
    module: str = ""
    usage: str = ""
    category: str = "misc"


@dataclass
class Module:
    name: str
    description: str = ""
    author: str = "Unknown"
    version: str = "1.0"
    commands: Dict[str, Command] = field(default_factory=dict)
    handlers: List[Any] = field(default_factory=list)
    on_load: Optional[Callable] = None
    on_unload: Optional[Callable] = None
    settings: Dict[str, Any] = field(default_factory=dict)
    settings_schema: List[Dict] = field(default_factory=list)
    requirements: List[str] = field(default_factory=list)


NOTES_FILE = "kub_notes.json"


def setup(bot):
    mod = Module(
        name="notes",
        description="–ó–∞–º–µ—Ç–∫–∏",
        author="Developer",
        version="1.0",
    )
    p = bot.config.prefix

    # –•—Ä–∞–Ω–∏–ª–∏—â–µ –∑–∞–º–µ—Ç–æ–∫ (–≤ settings –º–æ–¥—É–ª—è, –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∏–∑ on_unload)
    notes_data = {"notes": {}}

    def load_notes():
        if os.path.exists(NOTES_FILE):
            with open(NOTES_FILE, "r", encoding="utf-8") as f:
                notes_data["notes"] = json.load(f)

    def save_notes():
        with open(NOTES_FILE, "w", encoding="utf-8") as f:
            json.dump(notes_data["notes"], f, ensure_ascii=False, indent=2)

    async def on_load():
        load_notes()

    async def on_unload():
        save_notes()

    mod.on_load = on_load
    mod.on_unload = on_unload

    # –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ä–∞–∑—É
    load_notes()

    async def cmd_note(event):
        """–î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É: .note <–∏–º—è> <—Ç–µ–∫—Å—Ç>"""
        args = event.raw_text.split(maxsplit=2)
        if len(args) < 3:
            await event.edit(f"‚ùå `{p}note <–∏–º—è> <—Ç–µ–∫—Å—Ç>`")
            return
        name = args[1]
        text = args[2]
        notes_data["notes"][name] = text
        save_notes()
        await event.edit(f"üìù –ó–∞–º–µ—Ç–∫–∞ `{name}` —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!")

    async def cmd_notes(event):
        """–°–ø–∏—Å–æ–∫ –∑–∞–º–µ—Ç–æ–∫."""
        if not notes_data["notes"]:
            await event.edit("üì≠ –ó–∞–º–µ—Ç–æ–∫ –Ω–µ—Ç")
            return
        t = "üìù **–ó–∞–º–µ—Ç–∫–∏:**\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n"
        for name, text in notes_data["notes"].items():
            t += f"  üìå **{name}**: _{text[:50]}_\n"
        await event.edit(t)

    async def cmd_getnote(event):
        """–ü–æ–ª—É—á–∏—Ç—å –∑–∞–º–µ—Ç–∫—É: .getnote <–∏–º—è>"""
        args = event.raw_text.split(maxsplit=1)
        if len(args) < 2:
            await event.edit(f"‚ùå `{p}getnote <–∏–º—è>`")
            return
        name = args[1]
        text = notes_data["notes"].get(name)
        if text:
            await event.edit(f"üìå **{name}**:\n{text}")
        else:
            await event.edit(f"‚ùå –ó–∞–º–µ—Ç–∫–∞ `{name}` –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")

    async def cmd_delnote(event):
        """–£–¥–∞–ª–∏—Ç—å –∑–∞–º–µ—Ç–∫—É: .delnote <–∏–º—è>"""
        args = event.raw_text.split(maxsplit=1)
        if len(args) < 2:
            await event.edit(f"‚ùå `{p}delnote <–∏–º—è>`")
            return
        name = args[1]
        if name in notes_data["notes"]:
            del notes_data["notes"][name]
            save_notes()
            await event.edit(f"üóë –ó–∞–º–µ—Ç–∫–∞ `{name}` —É–¥–∞–ª–µ–Ω–∞")
        else:
            await event.edit(f"‚ùå `{name}` –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")

    mod.commands = {
        "note": Command("note", cmd_note, "–î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É", "notes", f"{p}note <–∏–º—è> <—Ç–µ–∫—Å—Ç>"),
        "notes": Command("notes", cmd_notes, "–°–ø–∏—Å–æ–∫ –∑–∞–º–µ—Ç–æ–∫", "notes", f"{p}notes"),
        "getnote": Command("getnote", cmd_getnote, "–ü–æ–ª—É—á–∏—Ç—å –∑–∞–º–µ—Ç–∫—É", "notes", f"{p}getnote <–∏–º—è>"),
        "delnote": Command("delnote", cmd_delnote, "–£–¥–∞–ª–∏—Ç—å –∑–∞–º–µ—Ç–∫—É", "notes", f"{p}delnote <–∏–º—è>"),
    }

    bot.module_manager.register_module(mod)
    bot.register_commands(mod)
```

### –ü—Ä–∏–º–µ—Ä 5: –ú–æ–¥—É–ª—å —Å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–º —Å–æ–±—ã—Ç–∏–π (–∞–Ω—Ç–∏—Å–ø–∞–º)

**`modules/antispam.py`**

```python
"""
–ü—Ä–æ—Å—Ç–æ–π –∞–Ω—Ç–∏—Å–ø–∞–º –º–æ–¥—É–ª—å.
"""

import time
from collections import defaultdict
from dataclasses import dataclass, field
from typing import Dict, List, Callable, Any, Optional
from telethon import events


@dataclass
class Command:
    name: str
    handler: Callable
    description: str = ""
    module: str = ""
    usage: str = ""
    category: str = "misc"


@dataclass
class Module:
    name: str
    description: str = ""
    author: str = "Unknown"
    version: str = "1.0"
    commands: Dict[str, Command] = field(default_factory=dict)
    handlers: List[Any] = field(default_factory=list)
    on_load: Optional[Callable] = None
    on_unload: Optional[Callable] = None
    settings: Dict[str, Any] = field(default_factory=dict)
    settings_schema: List[Dict] = field(default_factory=list)
    requirements: List[str] = field(default_factory=list)


def setup(bot):
    mod = Module(
        name="antispam",
        description="–ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞",
        author="Developer",
        version="1.0",
    )
    p = bot.config.prefix

    mod.settings_schema = [
        {
            "key": "enabled",
            "label": "–í–∫–ª—é—á–µ–Ω–æ",
            "type": "bool",
            "default": False,
            "description": "–í–∫–ª—é—á–∏—Ç—å –∞–Ω—Ç–∏—Å–ø–∞–º",
        },
        {
            "key": "max_messages",
            "label": "–ú–∞–∫—Å. —Å–æ–æ–±—â–µ–Ω–∏–π",
            "type": "int",
            "default": 5,
            "description": "–ú–∞–∫—Å–∏–º—É–º —Å–æ–æ–±—â–µ–Ω–∏–π –∑–∞ –ø–µ—Ä–∏–æ–¥",
        },
        {
            "key": "period",
            "label": "–ü–µ—Ä–∏–æ–¥ (—Å–µ–∫)",
            "type": "int",
            "default": 10,
            "description": "–ü–µ—Ä–∏–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö",
        },
        {
            "key": "action",
            "label": "–î–µ–π—Å—Ç–≤–∏–µ",
            "type": "str",
            "default": "warn",
            "description": "–î–µ–π—Å—Ç–≤–∏–µ –ø—Ä–∏ —Å–ø–∞–º–µ: warn, mute, kick",
        },
    ]

    # –•—Ä–∞–Ω–∏–ª–∏—â–µ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    user_messages = defaultdict(list)

    async def on_new_message(event):
        if event.out:
            return
        if not event.is_group:
            return

        enabled = module_config(bot, "antispam", "enabled", False)
        if not enabled:
            return

        max_msgs = module_config(bot, "antispam", "max_messages", 5)
        period = module_config(bot, "antispam", "period", 10)
        action = module_config(bot, "antispam", "action", "warn")

        uid = event.sender_id
        now = time.time()

        # –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏
        user_messages[uid] = [t for t in user_messages[uid] if now - t < period]
        user_messages[uid].append(now)

        if len(user_messages[uid]) > max_msgs:
            user_messages[uid].clear()
            user = await event.get_sender()
            name = user.first_name if user else "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"

            if action == "warn":
                await event.reply(f"‚ö†Ô∏è {name}, –Ω–µ —Å–ø–∞–º—å—Ç–µ!")
            elif action == "mute":
                try:
                    from telethon.tl.functions.channels import EditBannedRequest
                    from telethon.tl.types import ChatBannedRights
                    from datetime import datetime, timedelta
                    await bot.client(EditBannedRequest(
                        event.chat_id, uid,
                        ChatBannedRights(
                            until_date=datetime.now() + timedelta(minutes=5),
                            send_messages=True,
                        )
                    ))
                    await event.reply(f"üîá {name} –∑–∞–º—É—á–µ–Ω –Ω–∞ 5 –º–∏–Ω—É—Ç –∑–∞ —Å–ø–∞–º")
                except Exception as e:
                    await event.reply(f"‚ö†Ô∏è {name}, –Ω–µ —Å–ø–∞–º—å—Ç–µ! (–Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞–º—É—Ç–∏—Ç—å: {e})")
            elif action == "kick":
                try:
                    await bot.client.kick_participant(event.chat_id, uid)
                    await event.reply(f"üë¢ {name} –∫–∏–∫–Ω—É—Ç –∑–∞ —Å–ø–∞–º")
                except Exception as e:
                    await event.reply(f"‚ö†Ô∏è {name}, –Ω–µ —Å–ø–∞–º—å—Ç–µ! (–Ω–µ —É–¥–∞–ª–æ—Å—å –∫–∏–∫–Ω—É—Ç—å: {e})")

    handler = bot.client.on(events.NewMessage(incoming=True))(on_new_message)
    mod.handlers.append(handler)

    async def cmd_antispam(event):
        enabled = module_config(bot, "antispam", "enabled", False)
        max_msgs = module_config(bot, "antispam", "max_messages", 5)
        period = module_config(bot, "antispam", "period", 10)
        action = module_config(bot, "antispam", "action", "warn")

        await event.edit(
            f"üõ° **–ê–Ω—Ç–∏—Å–ø–∞–º**\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n"
            f"{'‚úÖ' if enabled else '‚ùå'} –°—Ç–∞—Ç—É—Å: {'–í–∫–ª' if enabled else '–í—ã–∫–ª'}\n"
            f"üìä –õ–∏–º–∏—Ç: {max_msgs} —Å–æ–æ–±—â–µ–Ω–∏–π –∑–∞ {period}—Å\n"
            f"‚ö° –î–µ–π—Å—Ç–≤–∏–µ: `{action}`\n\n"
            f"–ù–∞—Å—Ç—Ä–æ–π–∫–∞: `{p}fcfg set -m antispam <param> <value>`"
        )

    mod.commands = {
        "antispam": Command("antispam", cmd_antispam, "–°—Ç–∞—Ç—É—Å –∞–Ω—Ç–∏—Å–ø–∞–º–∞", "antispam", f"{p}antispam"),
    }

    bot.module_manager.register_module(mod)
    bot.register_commands(mod)
```

### –ü—Ä–∏–º–µ—Ä 6: –ú–æ–¥—É–ª—å –±–µ–∑ setup() (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥)

–ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –º–æ–¥—É–ª—å, –∫–æ—Ç–æ—Ä—ã–π —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞, –±–µ–∑ `setup()`:

**`modules/quickmod.py`**

```python
"""
–ë—ã—Å—Ç—Ä—ã–π –º–æ–¥—É–ª—å –±–µ–∑ setup().
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç –≤–Ω–µ–¥—Ä—ë–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ bot, client, config, manager.
"""

from dataclasses import dataclass, field
from typing import Dict, List, Callable, Any, Optional


@dataclass
class Command:
    name: str
    handler: Callable
    description: str = ""
    module: str = ""
    usage: str = ""
    category: str = "misc"


@dataclass
class Module:
    name: str
    description: str = ""
    author: str = "Unknown"
    version: str = "1.0"
    commands: Dict[str, Command] = field(default_factory=dict)
    handlers: List[Any] = field(default_factory=list)
    on_load: Optional[Callable] = None
    on_unload: Optional[Callable] = None
    settings: Dict[str, Any] = field(default_factory=dict)
    settings_schema: List[Dict] = field(default_factory=list)
    requirements: List[str] = field(default_factory=list)


# bot, client, config, manager ‚Äî —É–∂–µ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ –∏–º—ë–Ω

_mod = Module(
    name="quickmod",
    description="–ë—ã—Å—Ç—Ä—ã–π –º–æ–¥—É–ª—å",
    author="Me",
    version="0.1",
)

_p = config.prefix  # config –≤–Ω–µ–¥—Ä—ë–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏


async def cmd_quick(event):
    await event.edit("‚ö° –ë—ã—Å—Ç—Ä—ã–π –º–æ–¥—É–ª—å —Ä–∞–±–æ—Ç–∞–µ—Ç!")


_mod.commands = {
    "quick": Command("quick", cmd_quick, "–ë—ã—Å—Ç—Ä–∞—è –∫–æ–º–∞–Ω–¥–∞", "quickmod", f"{_p}quick"),
}

# –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –±–µ–∑ setup()
manager.register_module(_mod)  # manager –≤–Ω–µ–¥—Ä—ë–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
bot.register_commands(_mod)    # bot –≤–Ω–µ–¥—Ä—ë–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
```

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –≠—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ `setup()` –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–µ–µ, —Ç–∞–∫ –∫–∞–∫ —è–≤–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ—á–∫—É –≤—Ö–æ–¥–∞ –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–æ–ª–µ–µ —á–∏—Å—Ç—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É.

---

## 19. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∏ best practices

### –ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ

- **–ò–º—è –º–æ–¥—É–ª—è** = –∏–º—è —Ñ–∞–π–ª–∞ –±–µ–∑ `.py`, —Å—Ç—Ä–æ—á–Ω—ã–µ –±—É–∫–≤—ã, –±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤
- **–ò–º–µ–Ω–∞ –∫–æ–º–∞–Ω–¥** ‚Äî –∫–æ—Ä–æ—Ç–∫–∏–µ, –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω—ã–µ, —Å—Ç—Ä–æ—á–Ω—ã–µ: `weather`, `note`, `ban`
- –ò–∑–±–µ–≥–∞–π—Ç–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏: `alive`, `help`, `ping`, `eval`, `exec`, `modules`, `reload`, `settings`, `status`, `im`, `um`, `dlm`, `lm`, `pip`, `fcfg`, `prefix`, `settoken`, `kinfo`, `kset`, `id`, `info`, `del`, `purge`, `chatinfo`, `calc`, `sd`, `search`, `reverse`, `upper`, `lower`, `mock`, `repeat`, `type`, `dice`, `coin`, `choose`, `rate`, `ban`, `unban`, `kick`, `mute`, `unmute`, `pin`, `unpin`

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

```python
async def cmd_example(event):
    try:
        # –í–∞—à–∞ –ª–æ–≥–∏–∫–∞
        result = await some_operation()
        await event.edit(f"‚úÖ {result}")
    except FloodWaitError as e:
        await event.edit(f"‚è≥ –ü–æ–¥–æ–∂–¥–∏—Ç–µ {e.seconds} —Å–µ–∫—É–Ω–¥")
    except ChatAdminRequiredError:
        await event.edit("‚ùå –ù—É–∂–Ω—ã –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞")
    except Exception as e:
        await event.edit(f"‚ùå –û—à–∏–±–∫–∞: {e}")
```

### –†–∞–±–æ—Ç–∞ —Å –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏

```python
async def cmd_example(event):
    args = event.raw_text.split(maxsplit=2)
    # args[0] = ".command"
    # args[1] = –ø–µ—Ä–≤—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç (–µ—Å–ª–∏ –µ—Å—Ç—å)
    # args[2] = –æ—Å—Ç–∞–ª—å–Ω–æ–π —Ç–µ–∫—Å—Ç (–µ—Å–ª–∏ –µ—Å—Ç—å)
    
    if len(args) < 2:
        await event.edit(f"‚ùå –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: `{p}example <arg>`")
        return
    
    arg1 = args[1]
    rest = args[2] if len(args) > 2 else ""
```

### –†–∞–±–æ—Ç–∞ —Å reply-—Å–æ–æ–±—â–µ–Ω–∏—è–º–∏

```python
async def cmd_example(event):
    # –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—Å—Ç –∏–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–∞ –∏–ª–∏ –∏–∑ reply
    args = event.raw_text.split(maxsplit=1)
    text = None
    
    if len(args) > 1:
        text = args[1]
    elif event.is_reply:
        reply = await event.get_reply_message()
        text = reply.text or ""
    
    if not text:
        await event.edit("‚ùå –£–∫–∞–∂–∏—Ç–µ —Ç–µ–∫—Å—Ç –∏–ª–∏ –æ—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ")
        return
```

### –î–ª–∏–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

```python
async def cmd_download(event):
    await event.edit("‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...")
    
    try:
        # –î–ª–∏–Ω–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
        result = await long_operation()
        await event.edit(f"‚úÖ –ì–æ—Ç–æ–≤–æ: {result}")
    except Exception as e:
        await event.edit(f"‚ùå {e}")
```

### –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–∞–π–ª–æ–≤

```python
async def cmd_export(event):
    data = "–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞"
    
    # –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–∞–∫ —Ñ–∞–π–ª
    await event.delete()
    await bot.client.send_file(
        event.chat_id,
        file=data.encode("utf-8"),
        attributes=[DocumentAttributeFilename("export.txt")],
        caption="üìé –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö",
    )
```

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª–∏–Ω—ã —Ç–µ–∫—Å—Ç–∞

Telegram –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –¥–ª–∏–Ω—É —Å–æ–æ–±—â–µ–Ω–∏—è –¥–æ 4096 —Å–∏–º–≤–æ–ª–æ–≤. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `truncate()`:

```python
async def cmd_long(event):
    very_long_text = "..." * 10000
    await event.edit(truncate(very_long_text))
```

### –ù–µ –±–ª–æ–∫–∏—Ä—É–π—Ç–µ event loop

```python
# ‚ùå –ü–ª–æ—Ö–æ:
import time
time.sleep(5)

# ‚úÖ –•–æ—Ä–æ—à–æ:
import asyncio
await asyncio.sleep(5)

# ‚ùå –ü–ª–æ—Ö–æ (–±–ª–æ–∫–∏—Ä—É—é—â–∏–π HTTP-–∑–∞–ø—Ä–æ—Å):
import requests
resp = requests.get(url)

# ‚úÖ –•–æ—Ä–æ—à–æ (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å):
import aiohttp
async with aiohttp.ClientSession() as session:
    async with session.get(url) as resp:
        data = await resp.text()
```

### –û—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ –≤—ã–≥—Ä—É–∑–∫–µ

–ï—Å–ª–∏ –º–æ–¥—É–ª—å —Å–æ–∑–¥–∞—ë—Ç —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏, –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ñ–∞–π–ª—ã –∏–ª–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è ‚Äî –æ—á–∏—â–∞–π—Ç–µ –∏—Ö –≤ `on_unload`:

```python
_tasks = []

async def on_unload():
    for task in _tasks:
        task.cancel()
    _tasks.clear()

mod.on_unload = on_unload
```

---

## 20. –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –ø–æ –æ–±—ä–µ–∫—Ç–∞–º

### event (events.NewMessage.Event)

| –°–≤–æ–π—Å—Ç–≤–æ/–ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------------|----------|
| `event.raw_text` | –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è (str) |
| `event.text` | –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è |
| `event.message` | –û–±—ä–µ–∫—Ç Message |
| `event.chat_id` | ID —á–∞—Ç–∞ |
| `event.sender_id` | ID –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è |
| `event.is_reply` | –Ø–≤–ª—è–µ—Ç—Å—è –ª–∏ –æ—Ç–≤–µ—Ç–æ–º (bool) |
| `event.is_group` | –°–æ–æ–±—â–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø–µ (bool) |
| `event.is_private` | –õ–∏—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (bool) |
| `event.is_channel` | –°–æ–æ–±—â–µ–Ω–∏–µ –≤ –∫–∞–Ω–∞–ª–µ (bool) |
| `event.out` | –ò—Å—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (bool) |
| `event.photo` | –§–æ—Ç–æ (–µ—Å–ª–∏ –µ—Å—Ç—å) |
| `event.document` | –î–æ–∫—É–º–µ–Ω—Ç (–µ—Å–ª–∏ –µ—Å—Ç—å) |
| `event.media` | –ú–µ–¥–∏–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å) |
| `await event.edit(text)` | –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ |
| `await event.reply(text)` | –û—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ |
| `await event.delete()` | –£–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ |
| `await event.get_reply_message()` | –ü–æ–ª—É—á–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ-–æ—Ç–≤–µ—Ç |
| `await event.get_sender()` | –ü–æ–ª—É—á–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è |
| `await event.get_chat()` | –ü–æ–ª—É—á–∏—Ç—å —á–∞—Ç |

### User (telethon.tl.types.User)

| –°–≤–æ–π—Å—Ç–≤–æ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|
| `user.id` | ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `user.first_name` | –ò–º—è |
| `user.last_name` | –§–∞–º–∏–ª–∏—è |
| `user.username` | Username |
| `user.phone` | –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ |
| `user.bot` | –ë–æ—Ç –ª–∏ (bool) |
| `user.premium` | Premium-–∞–∫–∫–∞—É–Ω—Ç (bool) |
| `user.verified` | –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω (bool) |

---

## 21. FAQ

### –ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Å—Ç–µ–π—à–∏–π –º–æ–¥—É–ª—å?

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª –≤ `modules/`, –æ–ø—Ä–µ–¥–µ–ª–∏—Ç–µ `setup(bot)`, —Å–æ–∑–¥–∞–π—Ç–µ `Module` –∏ `Command`, –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –∏—Ö.

### –ü–æ—á–µ–º—É –º–æ–π –º–æ–¥—É–ª—å –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è?

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ñ–∞–π–ª –≤ –ø–∞–ø–∫–µ `modules/` –∏ –∏–º–µ–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ `.py`
2. –ò–º—è —Ñ–∞–π–ª–∞ –Ω–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `_`
3. –ú–æ–¥—É–ª—å –Ω–µ –≤ —Å–ø–∏—Å–∫–µ `disabled_modules` –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫: `–û—à–∏–±–∫–∞ <filename>: ...`
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å Python

### –ö–∞–∫ –æ—Ç–ª–∞–¥–∏—Ç—å –º–æ–¥—É–ª—å?

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é –∫–æ–º–∞–Ω–¥—É `.eval` –∏–ª–∏ `.exec` –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

```
.eval bot.module_manager.modules.get("mymod")
.eval module_config(bot, "mymod", "key")
```

### –ö–∞–∫ –æ–±–Ω–æ–≤–∏—Ç—å –º–æ–¥—É–ª—å?

–ü—Ä–æ—Å—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –µ–≥–æ –∑–∞–Ω–æ–≤–æ —á–µ—Ä–µ–∑ `.im` –∏–ª–∏ `.dlm` ‚Äî —Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è –±—É–¥–µ—Ç –≤—ã–≥—Ä—É–∂–µ–Ω–∞ –∏ –∑–∞–º–µ–Ω–µ–Ω–∞.

### –ü–æ—á–µ–º—É –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è?

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã —á–∏—Ç–∞–µ—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —á–µ—Ä–µ–∑ `module_config()` –ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤—ã–∑–æ–≤–µ –∫–æ–º–∞–Ω–¥—ã, –∞ –Ω–µ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –º–æ–¥—É–ª—è
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∏–º—è –º–æ–¥—É–ª—è —Å–æ–≤–ø–∞–¥–∞–µ—Ç: `module_config(bot, "—Ç–æ—á–Ω–æ–µ_–∏–º—è_–º–æ–¥—É–ª—è", ...)`
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `.fcfg set -m <mod>` –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Ç–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è

### –ö–∞–∫ —Å–¥–µ–ª–∞—Ç—å –º–æ–¥—É–ª—å, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ñ–æ–Ω–µ?

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `asyncio.create_task()`:

```python
import asyncio

async def background_task(bot):
    while True:
        # –í–∞—à–∞ –ª–æ–≥–∏–∫–∞
        await asyncio.sleep(60)

def setup(bot):
    task = asyncio.get_event_loop().create_task(background_task(bot))
    mod.settings["_task"] = task
    
    async def on_unload():
        task = mod.settings.get("_task")
        if task:
            task.cancel()
    
    mod.on_unload = on_unload
```

### –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ Telethon API –Ω–∞–ø—Ä—è–º—É—é?

```python
from telethon.tl.functions.messages import GetHistoryRequest

async def cmd_history(event):
    result = await bot.client(GetHistoryRequest(
        peer=event.chat_id,
        offset_id=0,
        offset_date=None,
        add_offset=0,
        limit=10,
        max_id=0,
        min_id=0,
        hash=0,
    ))
    await event.edit(f"–ü–æ–ª—É—á–µ–Ω–æ {len(result.messages)} —Å–æ–æ–±—â–µ–Ω–∏–π")
```

### –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å inline-–±–æ—Ç–∞ –∏–∑ –º–æ–¥—É–ª—è?

–î–∞, —á–µ—Ä–µ–∑ `bot.inline_panel.inline_bot`:

```python
if bot.inline_panel.active:
    await bot.inline_panel.inline_bot.send_message(user_id, "–ü—Ä–∏–≤–µ—Ç –æ—Ç –±–æ—Ç–∞!")
```

### –ö–∞–∫ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, —á—Ç–æ —é–∑–µ—Ä–±–æ—Ç –≤ –≥—Ä—É–ø–ø–µ, –∞ –Ω–µ –≤ –õ–°?

```python
async def cmd_example(event):
    if event.is_private:
        await event.edit("–≠—Ç–æ –õ–°")
    elif event.is_group:
        await event.edit("–≠—Ç–æ –≥—Ä—É–ø–ø–∞")
    elif event.is_channel:
        await event.edit("–≠—Ç–æ –∫–∞–Ω–∞–ª")
```

---

## –®–∞–±–ª–æ–Ω –º–æ–¥—É–ª—è (–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ)

```python
"""
–û–ø–∏—Å–∞–Ω–∏–µ –≤–∞—à–µ–≥–æ –º–æ–¥—É–ª—è.

–ê–≤—Ç–æ—Ä: –í–∞—à–µ –∏–º—è
–í–µ—Ä—Å–∏—è: 1.0
"""
# requires: 

from dataclasses import dataclass, field
from typing import Dict, List, Callable, Any, Optional


@dataclass
class Command:
    name: str
    handler: Callable
    description: str = ""
    module: str = ""
    usage: str = ""
    category: str = "misc"


@dataclass
class Module:
    name: str
    description: str = ""
    author: str = "Unknown"
    version: str = "1.0"
    commands: Dict[str, Command] = field(default_factory=dict)
    handlers: List[Any] = field(default_factory=list)
    on_load: Optional[Callable] = None
    on_unload: Optional[Callable] = None
    settings: Dict[str, Any] = field(default_factory=dict)
    settings_schema: List[Dict] = field(default_factory=list)
    requirements: List[str] = field(default_factory=list)


def setup(bot):
    MOD_NAME = "mymodule"
    mod = Module(
        name=MOD_NAME,
        description="–û–ø–∏—Å–∞–Ω–∏–µ",
        author="–ê–≤—Ç–æ—Ä",
        version="1.0",
    )
    p = bot.config.prefix

    # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    mod.settings_schema = [
        {
            "key": "example_setting",
            "label": "–ü—Ä–∏–º–µ—Ä",
            "type": "str",
            "default": "–∑–Ω–∞—á–µ–Ω–∏–µ",
            "description": "–û–ø–∏—Å–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏",
        },
    ]

    # –ö–æ–º–∞–Ω–¥—ã
    async def cmd_example(event):
        setting = module_config(bot, MOD_NAME, "example_setting", "–∑–Ω–∞—á–µ–Ω–∏–µ")
        await event.edit(f"‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞: {setting}")

    mod.commands = {
        "example": Command(
            "example", cmd_example,
            "–û–ø–∏—Å–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã", MOD_NAME,
            f"{p}example",
        ),
    }

    # Lifecycle (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    async def on_load():
        pass

    async def on_unload():
        pass

    mod.on_load = on_load
    mod.on_unload = on_unload

    # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
    bot.module_manager.register_module(mod)
    bot.register_commands(mod)
```

---

**kazhurkeUserBot** v2.3.0 ‚Ä¢ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –º–æ–¥—É–ª—è–º ‚Ä¢ 2026
